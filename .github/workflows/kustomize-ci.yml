name: kustomize-ci
on:
  push:
    branches:
      - main
    paths:
      - '**/kustomization.yaml'
  pull_request:
jobs:
  job:
    runs-on: ubuntu-20.04
    strategy:
      matrix:
        # list of directories in the repo that hosts Terraform samples
        # update this list as new terraform samples are added to the repo
        shared-starts: [
          'shared/online-boutique-asm-manifests/base',
          'shared/online-boutique-asm-manifests/service-accounts',
        ]
    steps:
      - uses: actions/checkout@v3
      - name: kustomize build
        env:
          KUSTZOMIZE_DIR: ${{ matrix.shared-starts }}
        run: |
          cd $SAMPLE_DIR
          FOLDER_NAME=$(SAMEPLE_DIR | awk -F/ '{print $NF}')
          kustomize build . > kubernetes-$FOLDER_NAME.yaml
